[{{ $registry := (resources.GetRemote .Site.Params.registry) | unmarshal }}
{{ $Scratch := newScratch }}
{{ if eq .Params.slug "all" }}
{{ $Scratch.Set "pkgs" $registry }}
{{ else }}
{{ $Scratch.Set "pkgs" ( where ($registry) "_metadata.ropensci_category" .Params.slug ) }}
{{ end }}
{{ $len := (len ($Scratch.Get "pkgs"))}}
{{ range $key, $value := ($Scratch.Get "pkgs") }}
{{ $topics := "" }}
{{ if isset $value "_topics" }}
{{ $topics = ( delimit $value._topics "," ) }}
{{ end }}
{{ $maintainer := partial "accents/remove" (dict "string" ($value.Maintainer | replaceRE " <.*" "") "Site" site )  }}
{{ $details := partial "accents/remove" (dict "string" $value.Description "Site" site )  }}
{{ $keywords := partial "accents/remove" (dict "string" $topics "Site" site )  }}
 {{ dict "name" $value.Package "maintainer" $maintainer "description" $value.Title "details" $details "keywords" $keywords |  jsonify }}
 {{ if (lt $key ( sub $len 1 ) )}}, {{ end }}
 {{ end }}]