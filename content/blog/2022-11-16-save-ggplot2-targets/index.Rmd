---
slug: "post-template"
title: Post Title in Title Case
# Delete the package_version line below if your post is not about a package
package_version: 0.1.0
author:
  - Author Name1
  - Author Name2
# Set the date below to the publication date of your post
date: 2020-03-10
# Minimal tags for a post about a community-contributed package 
# that has passed software peer review are listed below
# Consult the Technical Guidelines for information on choosing tags
tags:
  - Software Peer Review
  - packages
  - R
  - community
# The summary below will be used by e.g. Twitter cards
description: "A very short summary of your post (~ 100 characters)"
# If you have no preferred image for Twitter cards,
# delete the twitterImg and twitterAlt lines below 
# - Replace "blog" with "technotes" as needed
# - Note no "/" symbol before "blog" here
# - Note "/" between year/month/day
twitterImg: blog/2019/06/04/post-template/name-of-image.png
twitterAlt: "Alternative description of the image"
# the text below is for populating the "share on Twitter" button
# if deleted, the title of the post will be used
tweet: "A post about blabla by @username!"
---

This is the R Markdown (.Rmd) template for a blog post or tech note. 
To generate your post with just Markdown (.md), use that template instead.

Throughout this template, including the YAML, 
you should change "post-template" to the slug of your post, 
and "2019-06-04" to your publication date.

Save this file under /content/blog/YYYY-MM-DD-slug/index.Rmd in the local copy of your roweb3 fork.

The chunk below ensures your plots will be inserted in the same folder as your Rmd so you can submit the bundle (.Rmd, .md, images) to roweb3.

```{r setup, include=FALSE}
# Options to have images saved in the post folder
# And to disable symbols before output
knitr::opts_chunk$set(fig.path = "", comment = "")

# knitr hook to make images output use Hugo options
knitr::knit_hooks$set(
  plot = function(x, options) {
    hugoopts <- options$hugoopts
    paste0(
      "{{<figure src=",
      '"', x, '" ',
      if (!is.null(hugoopts)) {
        glue::glue_collapse(
          glue::glue('{names(hugoopts)}="{hugoopts}"'),
          sep = " "
        )
      },
      ">}}\n"
    )
  }
)

# knitr hook to use Hugo highlighting options
knitr::knit_hooks$set(
  source = function(x, options) {
  hlopts <- options$hlopts
    paste0(
      "```r ",
      if (!is.null(hlopts)) {
      paste0("{",
        glue::glue_collapse(
          glue::glue('{names(hlopts)}={hlopts}'),
          sep = ","
        ), "}"
        )
      },
      "\n", glue::glue_collapse(x, sep = "\n"), "\n```\n"
    )
  }
)
```

The figure paths in the resulting Markdown will already be valid so you won't need to edit the Markdown file.

## Section heading in sentence case

Citation of the primary literature[^1]. 

Citation of a website[^2]. 

Citation of an R package[^3].

### Subsection heading

We recommend the use of [Hugo shortcodes](https://gohugo.io/content-management/shortcodes/) to include images, tweets, videos, gists, etc. In the Rmd file they need to be between `<!--html_preserve-->` and `<!--/html_preserve-->`.

**Add an image** by using a Hugo shortcode. The image is saved under `/content/blog/YYYY-MM-DD-slug/name-of-image.png`.

<!--html_preserve-->
{{< figure src = "name-of-image.png" width = "400" alt = "this is the alternative text" >}}
<!--/html_preserve-->

Consult the Technical Guidelines for tips on changing image size, alignment, and for advice on alternative text.

Below is another image, a plot generated by a code chunk, so you might see how to add alternative text and other options in this case. You can also use [all options documented for the figure shortcode](https://gohugo.io/content-management/shortcodes/#figure) except for `src` that will be created automatically when knitting.

```{r chunkname, hugoopts=list(alt="alternative text please make it informative", caption="this is what this image shows, write it here or in the paragraph after the image as you prefer", width=300)}
plot(1:10)
```

Once this file is knitted the plot above will be inserted with the correct syntax.


**Embed a tweet** by using a Hugo shortcode. 

<!--html_preserve-->
{{< tweet user="SanDiegoZoo" id="1453110110599868418" >}}
<!--/html_preserve-->


**Tweak code highlighting** Below you can see how to use Hugo [Chroma code highlighting options](https://gohugo.io/content-management/syntax-highlighting/#highlight-shortcode): highlight the 1st and 4th to 6th code lines, number lines as a table starting from 199.

```{r hl, hlopts = list(linenos='table',hl_lines='[1,"4-6"]',linenostart=199)}
a <- 1
a <- 1
a <- 1
a <- 1
a <- 1
a <- 1
a <- 1
```

# Saving ggplot2 object in targets workflow

I really enjoy using `targets` to save my data analysis projects. In them I often produce several figures using `ggplot2`.
I want to keep my plots accessible to be able to revisit them anytime and to assemble them with `patchwork` into more complex figures for paper.

Because I don't know a priori the sizes of the figures, I like to save the ggplot2 plots as R objects and not images.

## First solution: saving the entire `ggplot2` objects

My first solution was to not worry about the plots and leverage the very clever system from targets that saves object.
This solution worked rather fine:

## Second (partial) solution: transform ggplot2 objects into grobs using target hooks

Learnt about target hooks.

But not recommended at all by ggplot2 folks. Risk of being very brittle. Didn't work as well. Was less clear to manipulate them.

Do this are you own risk (if you really know about `grid` and `Grob`s probably)

## Third (final solution): save the `ggplot2` but thinning the plotting environment

example of plot and change in size of object. (Where are we getting)

Need to care about whatever is floating around when creating

## Alternative solution: saving plot as images

When asked on rOpenSci Slack, some people mentioned they were always saving the plots as images. This can also work (maybe also with a hook), though you need to know the dimensions you're saving the objects to in advance.

## Summary

Explored solutions to save ggplot2 objects in target workflows:

* Saving `ggplot2` objects directly without consideration may accidentally save bigger objects because it saves the plot environment
* `targets` hooks can help you post-process targets automatically
* Saving `ggplot2` as `Grob` is not recommended and shouldn't be done
* The solution is to save `ggplot2` and thinning any object that may be staying in the environment

**Add citation or footnote** text by using the format below 

[^1]: Sciaini, M., Fritsch, M., Scherer, C., & Simpkins, C. E. (2018). NLMR and landscapetools: An integrated environment for simulating and modifying neutral landscape models in R. Methods in Ecology and Evolution, 9(11), 2240-2248. <https://doi.org/10.1111/2041-210X.13076>
[^2]: Elin Waring, Michael Quinn, Amelia McNamara, Eduardo Arino de la Rubia, Hao Zhu and Shannon Ellis (2019). skimr: Compact and Flexible Summaries of Data. R package version 1.0.7. https://CRAN.R-project.org/package=skimr
[^3]: Hugo static site generator. https://gohugo.io/